import tkinter as tk
import pyttsx3

initials = ["", "b", "p", "m", "f", "d", "t", "n", "l", "g", "k", "h",
            "j", "q", "x", "zh", "ch", "sh", "r", "z", "c", "s", "y", "w"]

finals = [
    "a", "o", "e", "i", "u", "Ã¼", "ai", "ei", "ao", "ou",
    "an", "en", "ang", "eng", "ong", "ia", "ie", "iao", "iou",
    "ian", "in", "iang", "ing", "ua", "uo", "uai", "uei",
    "uan", "uen", "uang", "ueng", "Ã¼e", "Ã¼an", "Ã¼n"
]

# è‡ªåŠ¨å°†æŒ‰é’®æŒ‰æ¯è¡Œ max_cols ä¸ªæ’åˆ—
def create_button_grid(parent, items, command_func, max_cols=15):
    frame = tk.Frame(parent)
    frame.pack()
    for idx, item in enumerate(items):
        row = idx // max_cols
        col = idx % max_cols
        txt = "âˆ…" if item == "" else item
        btn = tk.Button(frame, text=txt, width=4,
                        command=lambda i=item: command_func(i))
        btn.grid(row=row, column=col, padx=2, pady=2)
    return frame

class PinyinComposer:
    def __init__(self, root):
        self.root = root
        self.root.title("PinyinComposer")
        self.root.geometry("800x600")
        self.root.minsize(600, 400)

        self.selected_initial = ""
        self.selected_final = ""

        self.result_label = tk.Label(root, text="Chose consonant and vowel", font=("Arial", 18))
        self.result_label.pack(pady=10)

        # å£°æ¯åŒºï¼ˆè‡ªåŠ¨æ¢è¡Œï¼‰
        tk.Label(root, text="ğŸ”Š consonant", font=("Arial", 12)).pack(anchor="w", padx=20, pady=(10, 0))
        self.initial_frame = create_button_grid(root, initials, self.select_initial, max_cols=16)

        # éŸµæ¯åŒºï¼ˆè‡ªåŠ¨æ¢è¡Œï¼‰
        tk.Label(root, text="ğŸµ vowel", font=("Arial", 12)).pack(anchor="w", padx=20, pady=(10, 0))
        self.final_frame = create_button_grid(root, finals, self.select_final, max_cols=16)

        # å£°è°ƒæŒ‰é’®ï¼ˆä¿æŒåŸæ ·ï¼‰
        tone_frame = tk.Frame(root)
        tone_frame.pack(pady=20)
        tk.Label(tone_frame, text="ğŸ—£ï¸ click pronunciationï¼š").pack()
        for tone in range(1, 5):
            tk.Button(tone_frame, text=f"{tone} tone", width=8,
                      command=lambda t=tone: self.speak(t)).pack(side=tk.LEFT, padx=10)

    def select_initial(self, ini):
        self.selected_initial = ini
        self.update_display()

    def select_final(self, fin):
        self.selected_final = fin
        self.update_display()

    def update_display(self):
        if self.selected_final:
            self.result_label.config(text=self.selected_initial + self.selected_final)
        else:
            self.result_label.config(text="choose vowel")

    def speak(self, tone):
        if not self.selected_final:
            return
        pinyin = self.selected_initial + self.selected_final + str(tone)
        engine = pyttsx3.init()
        voices = engine.getProperty('voices')
        for v in voices:
            if 'zh' in str(v.languages).lower() or 'Chinese' in v.name or 'Huihui' in v.name:
                engine.setProperty('voice', v.id)
                break
        engine.setProperty('rate', 180)
        engine.say(pinyin)
        engine.runAndWait()
        engine.stop()

if __name__ == "__main__":
    root = tk.Tk()
    app = PinyinComposer(root)
    root.mainloop()